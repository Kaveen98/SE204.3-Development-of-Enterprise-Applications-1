"use strict";(self.__LOADABLE_LOADED_CHUNKS__=self.__LOADABLE_LOADED_CHUNKS__||[]).push([[97300],{552341:(e,t,r)=>{r.d(t,{Z:()=>a});var s=r(149722);let a=()=>{let e=(0,s.Z)(),t=!!e.isAuth&&e.isPartner;return t}},368552:(e,t,r)=>{r.d(t,{FE:()=>N,lG:()=>f,d9:()=>C});var s=r(667294),a=r(616550),i=r(552341),n=r(516018),u=r(340523),l=r(149722),c=r(953565);let d=()=>{let e=(0,l.Z)(),{checkExperiment:t}=(0,u.F)(),r=(0,i.Z)()&&t("web_m10n_business_reporting_business_entity_service").anyEnabled,[a,d]=(0,s.useState)({isReady:!1}),_=(0,s.useCallback)(async({entityId:e,actingBusinessId:t,favorites:s})=>{r&&(await (0,n.yo)({entityId:e,actingBusinessId:t,favorites:s}),d(e=>{let r={...e,actingBusinessId:t};return s&&(r.favoriteAdAccounts={favoriteAdAccountsMap:{...e.favoriteAdAccounts?.favoriteAdAccountsMap||{},[s.actingBusinessId]:{advertiserId:s.adAccounts}}}),r}))},[r]);return(0,s.useEffect)(()=>{r&&e.isAuth&&!a.isReady&&(async()=>{let t=!1;try{let t=await (0,n.SF)({entityId:e.id});d(e=>({...e,...t}))}catch{t=!0}finally{(0,c.nP)("globalAccountSwitcher.getFavoriteAdAccounts",{sampleRate:1,tags:{businessId:e.id,hasError:t}}),d(e=>({...e,isReady:!0}))}})()},[a.isReady,r,e]),{accountSwitcherConfig:a,setConfig:_}};var _=r(354500),m=r(214877),S=r(342513),o=r(96157),A=r(624797),E=r(529271),p=r(23234),g=r(441354),y=r(785893);let{Provider:I,useHook:C}=(0,S.Z)("AccountSwitcherContext"),f=e=>e.search&&(0,A.mB)(e.search).advertiserId,N=({children:e})=>{let{checkExperiment:t}=(0,u.F)(),{anyEnabled:r}=t("business_access_assets_and_history_api_v4_migration"),c=(0,a.TH)(),{params:{userBizId:S,businessHierarchyId:A,advertiserId:C,username:N}}=(0,a.$B)(),$=f(c),h=(0,l.Z)(),[O,R]=(0,s.useState)(""),[U,T]=(0,s.useState)(null),[b,v]=(0,s.useState)(!1),[B,D]=(0,s.useState)(null),L=new URLSearchParams(c.search),[P,w]=(0,s.useState)(L.has("actingBusinessId")?null:{id:h.id||"",name:h.fullName||"",img:h.imageMediumUrl||""}),[H,Z]=(0,s.useState)(!1),G=(0,i.Z)(),{logContextEvent:M}=(0,m.v)(),{accountSwitcherConfig:z,setConfig:F}=d();(0,s.useEffect)(()=>{A?R(A):R("")},[A]);let k=(0,s.useCallback)(async({id:e,username:t})=>{let r=await (0,n.bG)({user_id:e,username:t});r&&D({type:e?_.Oz.BUSINESS_ACCOUNT:_.Oz.PROFILE,id:e||r.id,name:r.full_name,img:r.image_medium_url,username:t}),Z(!1)},[]),Y=(0,g.rc)(N);(0,s.useEffect)(()=>{(0,o.cD)(c)&&B&&Y!==N&&N===h.username&&(k({username:h.username}),w({id:h.id||"",name:h.fullName||"",img:h.imageMediumUrl||""}),T({type:_.nt,id:h.id}))},[c,Y,k,B,N,h.fullName,h.id,h.imageMediumUrl,h.username]),(0,s.useEffect)(()=>{let e=async({businessId:e,assetId:t})=>{if(!e){Z(!1);return}try{if(r){if(P&&h.isAuth){let{data:{data:e=[{asset:{name:""},type:"AD_ACCOUNT"}]}={}}=await (0,p.QC)({id:P.id,businessId:P.id,personId:h.id,startIndex:0,searchBy:"id",searchTerm:t,sortBy:"name",sortDirection:"ASCENDING",limit:1,includeAssetSummary:!0}),{asset:r,type:s}=e[0];D({id:t,name:r.name,img:"",type:s})}}else{let{data:{data:{asset:r,type:s}}}=await (0,E.G2)({businessId:e,assetId:t,resourceType:"AD_ACCOUNT",includeAssetSummary:!0});D({id:t,name:r.name,img:"",type:s})}}catch{D({id:h.id||"",name:h.fullName||"",img:h.imageMediumUrl||"",type:_.Oz.BUSINESS_ACCOUNT})}Z(!1)},t=async({id:e})=>{let t=await (0,n.p)({hierarchyId:e});D({id:e,name:t?.data?t.data.name:"",img:t?.data?t.data.img_medium_url:"",type:_.Oz.BUSINESS_HIERARCHY}),Z(!1)};if(h.isAuth&&G&&!B&&!H){let r=(0,o.TI)(c)||(0,o.h3)(c),s=C||!!$&&!r;Z(!0),A?t({id:A}):S?k({id:S}):(0,o.cD)(c)&&N?k({username:N}):s?e({businessId:h.id,assetId:C||$||""}):(D({type:_.Oz.BUSINESS_ACCOUNT,id:h.id||"",name:h.fullName||"",img:h.imageMediumUrl||""}),Z(!1))}},[B,h,A,S,N,C,$,P,G,c,k,H,r]);let x=(0,s.useMemo)(()=>({activePanel:U,selectedHierarchyId:O,switcherOpen:b,openAccountSwitcher:()=>{if(M({event_type:101,view_type:608,component:14346}),!U){if((0,o.TI)(c))T({type:_.v8});else{let e=new URLSearchParams(c.search),t=e.get("actingBusinessId");T({type:_.nt,id:t??P?.id})}}v(!0)},closeAccountSwitcher:()=>v(!1),openAssetPanel:e=>{T({type:_.nt,id:e})},closeAssetPanel:()=>{T({type:_.v8})},actingBusiness:P,selectedAccount:B,setSelectedAccount:D,setActingBusiness:w,accountSwitcherConfig:z,setConfig:F}),[U,O,b,P,B,z,F,M,c]);return(0,y.jsx)(I,{value:x,children:e})}},593882:(e,t,r)=>{r.d(t,{C:()=>p,H:()=>g});var s=r(667294),a=r(552341),i=r(354500),n=r(516018),u=r(29156),l=r(250304),c=r(24691),d=r(342513),_=r(107366),m=r(244413),S=r(149722),o=r(186966),A=r(785893);let{Provider:E,useHook:p}=(0,d.Z)("BusinessHierarchyContext"),g=({children:e})=>{let[t,r]=(0,s.useState)([]),[d,p]=(0,s.useState)(!1),[g,y]=(0,s.useState)(!1),[I,C]=(0,s.useState)({}),[f,N]=(0,s.useState)(null),[$,h]=(0,s.useState)([]),[O,R]=(0,s.useState)({}),U=(0,o.Z)(),T=(0,s.useRef)(U),b=(0,S.Z)(),v=(0,a.Z)(),B=(0,s.useRef)({}),D=(0,s.useCallback)((e,t)=>{let r;t===i.Oz.BUSINESS_HIERARCHY?r=(0,c.Z)(l.Q6.DASHBOARD,"","",e):t===i.Oz.BUSINESS_ACCOUNT&&(r=(0,c.Z)(l.Q6.DASHBOARD,e));let s=(0,m.Z)({site:"www",path:r});(0,u.Z)(s)},[]),L=(0,s.useCallback)(async e=>{if(!v)return[];if(y(!0),B.current[e])return y(!1),B.current[e];{let t=await (0,_.Z)({url:"ads/v4/business_access/business_hierarchies/",data:{search_by:["FULL_NAME","BUSINESS_ID"],search_value:e}}),{data:r}=t.resource_response,s=r&&r.map(e=>(e.children&&(e.children=e.children.map(e=>(e.user.entity_type=i.Oz.USER_ACCOUNT,e))),e))||[],a=/^\d+$/.test(e),u=RegExp(e.toLowerCase(),"g"),l=[];f||N(l=await T.current());let c=f??l,d=c.filter(t=>{if(a)return t.id.includes(e);let r=t.user.full_name.toLowerCase();return r.match(u)}).map(n.IT),m=[...s.map(e=>e.id),...d.map(e=>e.id)],S=a?(b.id||"").includes(e):(b.fullName||"").toLowerCase().match(u);return b.isAuth&&S&&m.push(b.id),B.current[e]=m,y(!1),m}},[v,T,b.id,b.fullName,b.isAuth,f]),{id:P="",username:w="",email:H="",fullName:Z="",imageSmallUrl:G="",imageMediumUrl:M="",isAuth:z}=b,F=async e=>{if((!z||!v||f)&&!e)return;p(!0);let t=[];try{let e=await (0,_.Z)({url:"ads/v4/business_access/business_hierarchies/"}),{data:s}=e.resource_response;t=s&&s.map(e=>(e.children&&(e.children=e.children.map(e=>(e.user.entity_type=i.Oz.USER_ACCOUNT,e))),e))||[],r(t)}catch{r([])}try{let e=[];f||(e=await T.current(),N(e));let r=f??e;h(r.map(n.IT)),R(r.reduce((e,t)=>(e[t.id]=t.business_roles||[],e),{})),C((0,n.WP)({id:P,username:w,email:H,fullName:Z,imageSmallUrl:G,imageMediumUrl:M})),B.current[""]=[...t.map(e=>e.id),...r.map(n.IT).map(e=>e.id),P],p(!1)}catch{p(!1)}},k=(0,s.useCallback)(F,[P,w,H,Z,G,M,z,v,f]),Y=(0,s.useCallback)(e=>t.some(t=>t.id===e||t.children.some(t=>t.id===e||t.user.id===e)),[t]),x=(0,s.useCallback)(e=>t.map(e=>"BUSINESS_HIERARCHY"===e.entity_type?e:null).find(t=>!!t&&t.children.some(t=>t.user.id===e)),[t]),j=(0,s.useMemo)(()=>({businessHierarchies:[...I.id&&!Y(I.id)?[I]:[],...t,...$.filter(e=>!Y(e.id))],switchAccount:D,searchAccounts:L,loadingAccounts:d,isSearchingAccounts:g,fetchData:k,getParentHierarchyForIdIfExists:x,viewerRolesOfEachEmployer:O}),[t,D,L,$,d,g,I,k,Y,x,O]);return(0,A.jsx)(E,{value:j,children:e})}},516018:(e,t,r)=>{r.d(t,{IT:()=>d,SF:()=>A,Vq:()=>c,WP:()=>_,Yu:()=>o,bG:()=>S,p:()=>m,yo:()=>E});var s=r(216167),a=r(354500),i=r(107366),n=r(288673),u=r(562967),l=r(785893);let c=e=>({id:e.id,entity_type:a.Oz.BUSINESS_ACCOUNT,user:{id:e.user.id,entity_type:a.Oz.USER_ACCOUNT,username:e.user.username,email:e.user.email,full_name:e.user.full_name,image_small_url:e.user.image_small_url,image_medium_url:e.user.image_medium_url}}),d=e=>({id:e.id,entity_type:a.Oz.BUSINESS_ACCOUNT,requires_mfa_for_roles:e.requires_mfa_for_roles,user:{id:e.user.id,entity_type:a.Oz.USER_ACCOUNT,username:e.user.username,email:e.user.email,full_name:e.user.full_name,image_small_url:e.user.image_small_url,image_medium_url:e.user.image_medium_url}}),_=e=>({id:e.id,entity_type:a.Oz.BUSINESS_ACCOUNT,user:{id:e.id,entity_type:a.Oz.USER_ACCOUNT,username:e.username,email:e.email,full_name:e.fullName,image_small_url:e.imageSmallUrl,image_medium_url:e.imageMediumUrl}}),m=async({hierarchyId:e})=>{let t=await (0,i.Z)({url:`ads/v4/business_access/business_hierarchy/${e}/`});return t.resource_response},S=async({user_id:e,username:t})=>{if(!t&&!e)return null;let r=await s.Z.create("UserResource",{user_id:e,username:t}).callGet(),{resource_response:{data:a}}=r;return a},o=(0,l.jsx)("hr",{style:{borderTop:"1px solid #e9e9e9"}}),A=async({entityId:e})=>{let t=await (0,n.FO)([{entity_type:"BIZ_USER",entity_id:e,property_keys:["GLOBAL_ACCOUNT_SWITCHER_CONFIG"]}]),r=t[0];if(!(r&&r.properties))return{};let s=r.properties.GLOBAL_ACCOUNT_SWITCHER_CONFIG;return s},E=async({entityId:e,actingBusinessId:t,favorites:r})=>{let s={};(0,u.k)(t)||(s.actingBusinessId=t),r&&(s.favoriteAdAccounts={favoriteAdAccountsMap:{[r.actingBusinessId]:{advertiserId:r.adAccounts}}}),Object.keys(s).length>0&&await (0,n.RM)([{entity_type:"BIZ_USER",entity_id:e,properties:{GLOBAL_ACCOUNT_SWITCHER_CONFIG:s}}])}},24691:(e,t,r)=>{r.d(t,{Z:()=>i});let s="/business/business-manager/",a="/business/business-hierarchy/",i=(e,t,r,i)=>{switch(e){case"DASHBOARD":return i?`${a}${String(i)}/dashboard/`:`${s}${String(t)}/dashboard/`;case"PEOPLE":return`${s}${String(t)}/employees/`;case"PARTNERS":return`${s}${String(t)}/partners/`;case"AD_ACCOUNTS":return`${s}${String(t)}/ad-accounts/`;case"HISTORY":return`${s}${String(t)}/history/`;case"PEOPLE_DETAIL":return`${s}${String(t)}/employees/${String(r)}/details/`;case"PARTNERS_DETAIL":return`${s}${String(t)}/partners/${String(r)}/details/`;case"SHARED_PARTNERS_DETAIL":return`${s}${String(t)}/shared/${String(r)}/details/`;case"AD_ACCOUNTS_DETAIL":return`${s}${String(t)}/ad-accounts/${String(r)}/details/`;case"PENDING_AD_ACCOUNTS_DETAIL":return`${s}${String(t)}/ad-accounts/pending/${String(r)}/details/`;case"PEOPLE_INVITES":return`${s}${String(t)}/employees/invites/`;case"PEOPLE_PENDING_TAB":return`${s}${String(t)}/employees/pending/`;case"PARTNERS_PENDING_TAB":return`${s}${String(t)}/partners/pending/`;case"AD_ACCOUNTS_PENDING_TAB":return`${s}${String(t)}/ad-accounts/pending`;case"PARTNERS_INVITE_PAGE":return`${s}${String(t)}/partners/invites/`;case"PARTNERS_REQUEST_PAGE":return`${s}${String(t)}/partners/requests/`;case"PROFILES":return`${s}${String(t)}/profiles/`;case"PROFILES_DETAIL":return`${s}${String(t)}/profiles/${String(r)}/details/`;case"BUSINESS_SECURITY":return`${s}${String(t)}/security/`;case"SUPPORT_TOOL":return`${s}${String(t)}/support/`;case"ASSET_GROUPS":return r?`${s}${String(t)}/asset-groups/?asset_group_id=${String(r)}`:`${s}${String(t)}/asset-groups/`;case"INVOICE_MANAGEMENT":return`${s}${String(t)}/invoice-management/`;case"BUSINESS_HIERARCHY":return`${a}${String(i)}/hierarchy/`;case"BUSINESS_HIERARCHY_BUSINESS_SECURITY":return`${a}${String(i)}/business_security/`;case"MANAGERS":return`${a}${String(i)}/managers/`;case"AUDIENCES":return`${s}${String(t)}/audiences/`;case"SHARED_TAGS":return`${s}${String(t)}/shared-tags/`;case"CATALOGS":return`${s}${String(t)}/catalogs/`;case"BRAND_SAFETY":return`${s}${String(t)}/brand-safety/`;default:return s}}},186966:(e,t,r)=>{r.d(t,{Z:()=>i});var s=r(107366),a=r(5859);function i(){let{experimentsClient:e}=(0,a.B)();return async()=>{let{anyEnabled:t}=e.checkExperiment("business_access_employees_api_v4_migration")??{},r=await (0,s.Z)({url:t?"/ads/v4/business_access/businesses/me/employers/":"ads/internal/business_access/users/me/employers/"}),a=r.resource_response?r.resource_response.data:{data:[]};return await Promise.all(a&&a.data||[])}}},441354:(e,t,r)=>{r.d(t,{XI:()=>a,YZ:()=>n,rc:()=>i,sU:()=>c});var s=r(667294);function a(e){let[t,r]=(0,s.useState)(!1),a=()=>r(!0),i=()=>r(!1);return(0,s.useEffect)(()=>{let{current:t}=e;return t&&(t.addEventListener("mouseenter",a),t.addEventListener("mouseleave",i)),()=>{t&&(t.removeEventListener("mouseenter",a),t.removeEventListener("mouseleave",i))}}),t}let i=e=>{let t=(0,s.useRef)(e);return(0,s.useEffect)(()=>{t.current=e}),t.current};function n(){let e=(0,s.useRef)(!0);return(0,s.useEffect)(()=>{e.current=!1},[]),e.current}function u(e,t){return Object.is(e,t)}let l=Symbol("pre-initial value");function c(e,{equal:t=u,delta:r}={equal:u}){let a=(0,s.useRef)(l),i=a.current;return(0,s.useEffect)(()=>{a.current=e}),{previousValue:i,changed:i===l||!t(i,e),delta:r?.(i,e)}}}}]);
//# sourceMappingURL=https://sm.pinimg.com/webapp/97300-6a154abae7f00103.mjs.map